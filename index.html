<!DOCTYPE html>
<html>
	<head> 
		<script src="Construct2/Plugin/RandomDungeonMaker/common.js"> </script>
		<script src="scripts/Interface.js"> </script>
	</head>
	<body>
		<table style='width:800px;'>
			<tr>
				<td> Width: </td>
				<td> <input type="text" id="width" value="30" style='width:60px;'> </td>
				<td> Height: </td>
				<td> <input type="text" id="height" value="30" style='width:60px;'> </td>
				<td> Blocks: </td>
				<td> <input type="text" id="blocks" value="400" style='width:60px;'> </td>
				<td>
					<button type="button" onclick="testDungeon();" style='visibility:hidden'>TEST</button>
				</td>
			</tr>
			<tr>
				<td> Labyrinth Inn: </td>
				<td>
					<select id="LabyrinthInn">
						<option value="1">YES</option>
						<option value="0">NO</option>
					</select>
				</td>
				<td> Open World: </td>
				<td>
					<select id="OpenWorld">
						<option value="0">NO</option>
						<option value="1">YES</option>
					</select>
				</td>
				<td> Platforms: </td>
				<td>
					<select id="SupportPlatforms">
						<option value="1">YES</option>
						<option value="0">NO</option>
					</select>
				</td>
			</tr>
			<tr>
				<td> Shape: </td>
				<td>
					<select id="GameMode">
						<option value="LABYRINTH">LABYRINTH</option>
						<option value="CASTLE">CASTLE</option>
						<option value="TOWER">TOWER</option>
					</select>	
				</td>
				<td> Start X: </td>
				<td>
					<select id="PointX">
						<option value="0">CENTER</option>
						<option value="-1">LEFT</option>
						<option value="1">RIGHT</option>
					</select>	
				</td>
				<td> Start Y: </td>
				<td>
					<select id="PointY">
						<option value="LABYRINTH">CENTER</option>
						<option value="-1">TOP</option>
						<option value="1">BOTTOM</option>
					</select>	
				</td>
				<td>
					<button type="button" onclick="createDungeon();">GENERATE</button>
				</td>
			</tr>
		</table>
		<br/>
		<table>
			<tr>
				<td>
					<form onsubmit="download(this['name'].value, this['text'].value)">
						<input type="text" name="name" value="example.json">
						<input type="submit" value="Download">
						<br/>
						<textarea name="text" id="jsondata" style="display:none;"></textarea>
						<br/>
					</form>
				</td>
			</tr>
			<tr>
				<td>
					<div>
						<input type="file" id="input-file">
					</div>
				</td>
			</tr>
		</table>
		<br/>
		<div id="minimap"></div>
		<script type="text/javascript">
			createDungeon();
			document.getElementById('input-file').addEventListener('change', getFile);
			function createDungeon()
			{
				var GameDungeon = DungeonBasicConfiguration(document.getElementById('width').value,
															document.getElementById('height').value,
															document.getElementById('blocks').value);
			    GameDungeon.DungeonMode = document.getElementById('GameMode').value;
				GameDungeon.StartPointX = document.getElementById('PointX').value;
				GameDungeon.StartPointY = document.getElementById('PointY').value;
				GameDungeon.LabyrinthInn = document.getElementById('LabyrinthInn').value;
				GameDungeon.OpenWorld = document.getElementById('OpenWorld').value;
				GameDungeon.SupportPlatforms = document.getElementById('SupportPlatforms').value;
				//AddElement(GameDungeon, 'X', 20, 0, 'NO', 'NO', 'NO', 'NO', 'NO');
				GameDungeon = makeDungeon(GameDungeon);
				document.getElementById("minimap").innerHTML = GraphiqueDungeon(GameDungeon);
				document.getElementById("jsondata").innerHTML += JSON2.stringify(GameDungeon);
			}
			function testDungeon()
			{
				testAlgorithm(100000);
				alert("Terminado");
			}
			function download(filename, text)
			{
				var element = document.createElement('a');
				element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
				element.setAttribute('download', filename);
				element.style.display = 'none';
				document.body.appendChild(element);
				element.click();
				document.body.removeChild(element);
			}
			function getFile(event)
			{
				const input = event.target;
				if ('files' in input && input.files.length > 0)
				{
					placeFileContent(document.getElementById('jsondata'), input.files[0]);
				}
			}
			function placeFileContent(target, file)
			{
				readFileContent(file).then(content => {
					target.value = content;
					GameDungeon = JSON2.parse(content);
					document.getElementById("minimap").innerHTML = GraphiqueDungeon(GameDungeon);
				}).catch(error => console.log(error));
			}
			function readFileContent(file)
			{
				const reader = new FileReader();
				return new Promise((resolve, reject) =>
				{
					reader.onload = event => resolve(event.target.result);
					reader.onerror = error => reject(error);
					reader.readAsText(file);
				});
			}
		</script>
	</body>
</html>